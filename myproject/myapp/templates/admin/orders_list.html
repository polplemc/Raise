{% extends 'admin/base_new.html' %}

{% block title %}Orders{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-bold">All Orders</h2>
  <span class="badge bg-warning text-dark fs-6">View Only</span>
</div>

<!-- Statistics Cards -->
<div class="row row-cols-1 row-cols-md-4 g-3 mb-4">
  <div class="col">
    <div class="card text-center h-100">
      <div class="card-body">
        <i class="bi bi-cart text-secondary" style="font-size: 2rem;"></i>
        <h6 class="text-muted mt-2 mb-1">Total Orders</h6>
        <h3 class="mb-0">{{ total_orders }}</h3>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card text-center h-100">
      <div class="card-body">
        <i class="bi bi-clock text-warning" style="font-size: 2rem;"></i>
        <h6 class="text-muted mt-2 mb-1">Pending</h6>
        <h3 class="mb-0">{{ pending_orders }}</h3>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card text-center h-100">
      <div class="card-body">
        <i class="bi bi-check-circle text-primary" style="font-size: 2rem;"></i>
        <h6 class="text-muted mt-2 mb-1">Completed</h6>
        <h3 class="mb-0">{{ completed_orders }}</h3>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card text-center h-100">
      <div class="card-body">
        <i class="bi bi-truck text-info" style="font-size: 2rem;"></i>
        <h6 class="text-muted mt-2 mb-1">Delivered</h6>
        <h3 class="mb-0">{{ delivered_orders }}</h3>
      </div>
    </div>
  </div>
</div>

<!-- Search and Filter -->
<div class="card mb-4">
  <div class="card-body">
    <form method="GET" class="row g-3">
      <div class="col-md-4">
        <input type="text" name="search" class="form-control" placeholder="Search by owner or supplier..." value="{{ search }}">
      </div>
      <div class="col-md-3">
        <select name="order_status" class="form-select">
          <option value="">All Order Status</option>
          {% for value, label in order_status_choices %}
            <option value="{{ value }}" {% if order_status == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <select name="delivery_status" class="form-select">
          <option value="">All Delivery Status</option>
          {% for value, label in delivery_status_choices %}
            <option value="{{ value }}" {% if delivery_status == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-dark w-100">
          <i class="bi bi-filter"></i> Filter
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Orders Table -->
<div class="card">
  <div class="card-body">
    {% if orders %}
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Order #</th>
              <th>Owner</th>
              <th>Supplier</th>
              <th>Date</th>
              <th>Items</th>
              <th>Total</th>
              <th>Order Status</th>
              <th>Delivery Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for order in orders %}
            <tr>
              <td><strong>#{{ order.id }}</strong></td>
              <td>
                {{ order.store_owner.first_name }} {{ order.store_owner.last_name }}<br>
                <small class="text-muted">{{ order.store_owner.email }}</small>
              </td>
              <td>{{ order.supplier_product.supplier.username }}</td>
              <td>{{ order.created_at|date:"M d, Y H:i" }}</td>
              <td>{{ order.quantity }} {{ order.supplier_product.unit }}</td>
              <td><strong>â‚±{{ order.total_amount|floatformat:2 }}</strong></td>
              <td>
                {% if order.order_status == 'pending' %}
                  <span class="badge bg-warning text-dark">Pending</span>
                {% elif order.order_status == 'confirmed' %}
                  <span class="badge bg-info">Confirmed</span>
                {% elif order.order_status == 'processing' %}
                  <span class="badge bg-primary">Processing</span>
                {% elif order.order_status == 'completed' %}
                  <span class="badge bg-success">Completed</span>
                {% elif order.order_status == 'cancelled' %}
                  <span class="badge bg-danger">Cancelled</span>
                {% endif %}
              </td>
              <td>
                {% if order.delivery_status == 'not_shipped' %}
                  <span class="badge bg-secondary"><i class="bi bi-box"></i> Not Shipped</span>
                {% elif order.delivery_status == 'out_for_delivery' %}
                  <span class="badge bg-info"><i class="bi bi-truck"></i> Out for Delivery</span>
                {% elif order.delivery_status == 'delivered' %}
                  <span class="badge bg-success"><i class="bi bi-check-circle"></i> Delivered</span>
                {% elif order.delivery_status == 'returned' %}
                  <span class="badge bg-danger"><i class="bi bi-arrow-return-left"></i> Returned</span>
                {% endif %}
              </td>
              <td>
                <a href="{% url 'admin_order_detail' order.id %}" class="btn btn-sm btn-outline-dark">
                  <i class="bi bi-eye"></i> View
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-center py-5">
        <i class="bi bi-cart-x text-muted" style="font-size: 4rem;"></i>
        <h4 class="text-muted mt-3">No Orders</h4>
        <p class="text-muted">Orders will appear here when owners place them.</p>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
