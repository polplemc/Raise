{% extends 'admin/base_new.html' %}

{% block title %}Order Details{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-bold">Order #{{ order.id }}</h2>
  <a href="{% url 'admin_orders_list' %}" class="btn btn-outline-secondary">
    <i class="bi bi-arrow-left"></i> Back to Orders
  </a>
</div>

<div class="row">
  <div class="col-md-8">
    <!-- Order Details -->
    <div class="card mb-4">
      <div class="card-header bg-white">
        <h5 class="mb-0"><i class="bi bi-cart-check"></i> Order Details</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Product</th>
                <th>Unit Price</th>
                <th>Quantity</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <strong>{{ order.supplier_product.name }}</strong><br>
                  <small class="text-muted">Category: {{ order.supplier_product.get_category_display }}</small>
                </td>
                <td>₱{{ order.unit_price|floatformat:2 }} per {{ order.supplier_product.unit }}</td>
                <td>{{ order.quantity }} {{ order.supplier_product.unit }}</td>
                <td><strong>₱{{ order.total_amount|floatformat:2 }}</strong></td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <th colspan="3" class="text-end">Total Amount:</th>
                <th>₱{{ order.total_amount|floatformat:2 }}</th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>

    <!-- Order Notes -->
    {% if order.notes %}
    <div class="card">
      <div class="card-header bg-white">
        <h5 class="mb-0"><i class="bi bi-sticky"></i> Order Notes</h5>
      </div>
      <div class="card-body">
        <p class="mb-0">{{ order.notes }}</p>
      </div>
    </div>
    {% endif %}
  </div>

  <div class="col-md-4">
    <!-- Order Status -->
    <div class="card mb-3">
      <div class="card-header bg-white">
        <h5 class="mb-0">Order Status</h5>
      </div>
      <div class="card-body text-center">
        {% if order.order_status == 'pending' %}
          <div class="mb-3">
            <i class="bi bi-clock-history text-warning" style="font-size: 3rem;"></i>
          </div>
          <h5 class="text-warning">Pending</h5>
          <p class="text-muted small">Waiting for supplier confirmation</p>
        {% elif order.order_status == 'confirmed' %}
          <div class="mb-3">
            <i class="bi bi-check-circle text-info" style="font-size: 3rem;"></i>
          </div>
          <h5 class="text-info">Confirmed</h5>
          <p class="text-muted small">Order confirmed by supplier</p>
        {% elif order.order_status == 'processing' %}
          <div class="mb-3">
            <i class="bi bi-gear text-primary" style="font-size: 3rem;"></i>
          </div>
          <h5 class="text-primary">Processing</h5>
          <p class="text-muted small">Order is being prepared</p>
        {% elif order.order_status == 'completed' %}
          <div class="mb-3">
            <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
          </div>
          <h5 class="text-success">Completed</h5>
          <p class="text-muted small">Order transaction completed</p>
        {% elif order.order_status == 'cancelled' %}
          <div class="mb-3">
            <i class="bi bi-x-circle text-danger" style="font-size: 3rem;"></i>
          </div>
          <h5 class="text-danger">Cancelled</h5>
          <p class="text-muted small">Order was cancelled</p>
        {% endif %}
      </div>
    </div>

    <!-- Delivery Status -->
    <div class="card mb-3">
      <div class="card-header bg-white">
        <h5 class="mb-0">Delivery Status</h5>
      </div>
      <div class="card-body text-center">
        {% if order.delivery_status == 'not_shipped' %}
          <div class="mb-3">
            <i class="bi bi-box text-secondary" style="font-size: 3rem;"></i>
          </div>
          <h5 class="text-secondary">Not Yet Shipped</h5>
          <p class="text-muted small">Order has not been shipped</p>
        {% elif order.delivery_status == 'out_for_delivery' %}
          <div class="mb-3">
            <i class="bi bi-truck text-info" style="font-size: 3rem;"></i>
          </div>
          <h5 class="text-info">Out for Delivery</h5>
          <p class="text-muted small">Order is on the way</p>
        {% elif order.delivery_status == 'delivered' %}
          <div class="mb-3">
            <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
          </div>
          <h5 class="text-success">Delivered</h5>
          <p class="text-muted small">Order successfully delivered</p>
          {% if order.delivered_at %}
            <small class="text-muted">{{ order.delivered_at|date:"M d, Y H:i" }}</small>
          {% endif %}
        {% elif order.delivery_status == 'returned' %}
          <div class="mb-3">
            <i class="bi bi-arrow-return-left text-danger" style="font-size: 3rem;"></i>
          </div>
          <h5 class="text-danger">Returned</h5>
          <p class="text-muted small">Order was returned</p>
        {% endif %}
      </div>
    </div>

    <!-- Owner Info -->
    <div class="card mb-3">
      <div class="card-header bg-white">
        <h5 class="mb-0">Store Owner</h5>
      </div>
      <div class="card-body">
        <h6>{{ order.store_owner.first_name }} {{ order.store_owner.last_name }}</h6>
        <p class="small mb-0">
          {% if order.store_owner.profile.store_name %}
            <i class="bi bi-shop"></i> {{ order.store_owner.profile.store_name }}<br>
          {% endif %}
          <i class="bi bi-envelope"></i> {{ order.store_owner.email }}<br>
          {% if order.store_owner.profile.phone %}
            <i class="bi bi-telephone"></i> {{ order.store_owner.profile.phone }}
          {% endif %}
        </p>
      </div>
    </div>

    <!-- Supplier Info -->
    <div class="card mb-3">
      <div class="card-header bg-white">
        <h5 class="mb-0">Supplier</h5>
      </div>
      <div class="card-body">
        <h6>{{ order.supplier_product.supplier.username }}</h6>
        <p class="small mb-0">
          {% if order.supplier_product.supplier.first_name %}
            <i class="bi bi-person"></i> {{ order.supplier_product.supplier.first_name }} {{ order.supplier_product.supplier.last_name }}<br>
          {% endif %}
          <i class="bi bi-envelope"></i> {{ order.supplier_product.supplier.email }}
        </p>
      </div>
    </div>

    <!-- Payment Info -->
    <div class="card mb-3">
      <div class="card-header bg-white">
        <h5 class="mb-0">Payment Information</h5>
      </div>
      <div class="card-body">
        <p class="small mb-2">
          <strong>Payment Method:</strong><br>
          {% if order.payment_method == 'cod' %}
            <span class="badge bg-secondary">Cash on Delivery</span>
          {% elif order.payment_method == 'gcash' %}
            <span class="badge bg-primary">GCash</span>
          {% elif order.payment_method == 'paymaya' %}
            <span class="badge bg-success">PayMaya</span>
          {% elif order.payment_method == 'bank_transfer' %}
            <span class="badge bg-info">Bank Transfer</span>
          {% endif %}
        </p>
        <p class="small mb-0">
          <strong>Payment Status:</strong><br>
          {% if order.payment_status == 'pending' %}
            <span class="badge bg-warning text-dark">Pending</span>
          {% elif order.payment_status == 'paid' %}
            <span class="badge bg-success">Paid</span>
          {% elif order.payment_status == 'failed' %}
            <span class="badge bg-danger">Failed</span>
          {% endif %}
        </p>
        {% if order.payment_verified %}
          <p class="small mb-0 mt-2">
            <i class="bi bi-check-circle-fill text-success"></i> <strong>Verified</strong><br>
            <small class="text-muted">{{ order.verified_date|date:"M d, Y H:i" }}</small>
          </p>
        {% endif %}
      </div>
    </div>

    <!-- Order Info -->
    <div class="card">
      <div class="card-header bg-white">
        <h5 class="mb-0">Order Information</h5>
      </div>
      <div class="card-body">
        <p class="small mb-2">
          <strong>Order Date:</strong><br>
          {{ order.created_at|date:"F d, Y H:i" }}
        </p>
        <p class="small mb-2">
          <strong>Last Updated:</strong><br>
          {{ order.updated_at|date:"F d, Y H:i" }}
        </p>
        <p class="small mb-2">
          <strong>Quantity:</strong><br>
          {{ order.quantity }} {{ order.supplier_product.unit }}
        </p>
        {% if order.inventory_updated %}
          <p class="small mb-0">
            <i class="bi bi-check-circle text-success"></i> <strong>Inventory Updated</strong>
          </p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
