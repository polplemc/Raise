{% extends 'owner/base.html' %}

{% block title %}Staff Management{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="mb-0">Staff Management</h2>
  <a href="{% url 'owner_staff_add' %}" class="btn btn-warning">
    <i class="bi bi-person-plus"></i> Add Staff Member
  </a>
</div>

<!-- Summary Stats -->
<div class="row mb-4">
  <div class="col-md-4">
    <div class="card stat-card bg-yellow">
      <div class="card-body text-center">
        <i class="bi bi-people icon"></i>
        <h4 class="mb-1">{{ total_staff }}</h4>
        <p class="mb-0 small">Total Staff</p>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card stat-card bg-success text-white">
      <div class="card-body text-center">
        <i class="bi bi-person-check icon"></i>
        <h4 class="mb-1">{{ active_staff }}</h4>
        <p class="mb-0 small">Active Staff</p>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card stat-card bg-secondary text-white">
      <div class="card-body text-center">
        <i class="bi bi-person-x icon"></i>
        <h4 class="mb-1">{{ inactive_staff }}</h4>
        <p class="mb-0 small">Inactive Staff</p>
      </div>
    </div>
  </div>
</div>

<!-- Staff List -->
<div class="card">
  <div class="card-header">
    <h5 class="mb-0">Staff Members ({{ total_staff }})</h5>
  </div>
  <div class="card-body p-0">
    {% if staff_members %}
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>Staff Member</th>
            <th>Contact Info</th>
            <th>Status</th>
            <th>Created</th>
            <th>Last Updated</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for staff in staff_members %}
          <tr>
            <td>
              <div>
                <strong>{{ staff.user.first_name }} {{ staff.user.last_name }}</strong>
                <br><small class="text-muted">@{{ staff.user.username }}</small>
              </div>
            </td>
            <td>
              <div>
                {% if staff.user.email %}
                  <i class="bi bi-envelope me-1"></i>{{ staff.user.email }}<br>
                {% endif %}
                {% if staff.phone %}
                  <i class="bi bi-telephone me-1"></i>{{ staff.phone }}<br>
                {% endif %}
                {% if staff.address %}
                  <i class="bi bi-geo-alt me-1"></i>{{ staff.address|truncatewords:5 }}
                {% endif %}
              </div>
            </td>
            <td>
              {% if staff.is_active %}
                <span class="badge bg-success">Active</span>
              {% else %}
                <span class="badge bg-secondary">Inactive</span>
              {% endif %}
            </td>
            <td>
              <div>{{ staff.created_at|date:"M d, Y" }}</div>
              <small class="text-muted">{{ staff.created_at|time:"g:i A" }}</small>
            </td>
            <td>
              <div>{{ staff.updated_at|date:"M d, Y" }}</div>
              <small class="text-muted">{{ staff.updated_at|time:"g:i A" }}</small>
            </td>
            <td>
              <div class="btn-group btn-group-sm table-actions" role="group">
                <a href="{% url 'owner_staff_edit' staff.id %}" class="btn btn-outline-primary" title="Edit">
                  <i class="bi bi-pencil"></i>
                </a>
                <a href="{% url 'owner_staff_toggle_active' staff.id %}" 
                   class="btn {% if staff.is_active %}btn-outline-warning{% else %}btn-outline-success{% endif %}" 
                   title="{% if staff.is_active %}Deactivate{% else %}Activate{% endif %}">
                  <i class="bi bi-{% if staff.is_active %}pause{% else %}play{% endif %}"></i>
                </a>
                <a href="{% url 'owner_staff_reset_password' staff.id %}" class="btn btn-outline-info" title="Reset Password">
                  <i class="bi bi-key"></i>
                </a>
                <a href="{% url 'owner_staff_delete' staff.id %}" class="btn btn-outline-danger" title="Delete">
                  <i class="bi bi-trash"></i>
                </a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center py-5">
      <i class="bi bi-people text-muted" style="font-size: 3rem;"></i>
      <h5 class="text-muted mt-3">No staff members yet</h5>
      <p class="text-muted">Add staff members to help manage your store's inventory and operations.</p>
      <a href="{% url 'owner_staff_add' %}" class="btn btn-warning">
        <i class="bi bi-person-plus"></i> Add First Staff Member
      </a>
    </div>
    {% endif %}
  </div>
</div>

{% if staff_members %}
<div class="row mt-4">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h6 class="mb-0">Staff Permissions</h6>
      </div>
      <div class="card-body">
        <p class="small mb-2"><strong>Staff members can:</strong></p>
        <ul class="small mb-0">
          <li>View and manage your inventory</li>
          <li>Record stock out transactions</li>
          <li>View supplier orders and reports</li>
          <li>Access read-only business data</li>
        </ul>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h6 class="mb-0">Staff Restrictions</h6>
      </div>
      <div class="card-body">
        <p class="small mb-2"><strong>Staff members cannot:</strong></p>
        <ul class="small mb-0">
          <li>Manage other staff or suppliers</li>
          <li>Delete critical business data</li>
          <li>Access financial settings</li>
          <li>Modify business owner information</li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
